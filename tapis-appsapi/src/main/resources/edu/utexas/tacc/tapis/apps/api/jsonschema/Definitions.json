{
  "$id": "https://tapis.tacc.utexas.edu/Definitions",
  "$schema": "https://json-schema.org/draft-07/schema#",
  "description": "Common definitions for requests",
  "additionalProperties": false,

  "AppId": { "type": "string", "minLength": 1, "maxLength": 80 },
  "SystemId": { "type": ["string", "null"], "minLength": 1, "maxLength": 80 },
  "UserName": { "type": "string", "minLength": 1, "maxLength": 60 },
  "DirPath": { "type": ["string", "null"], "minLength": 1, "maxLength": 4096 },
  "AppTypeEnum": { "type": "string", "enum": [ "BATCH", "FORK" ] },
  "RuntimeEnum": { "type": "string", "enum": [ "SINGULARITY", "DOCKER" ] },
  "RuntimeOptionEnum": { "type": "string", "enum": [ "NONE", "SINGULARITY_START", "SINGULARITY_RUN" ] },
  "NotificationMechanismEnum": { "type": "string", "enum": [ "WEBHOOK", "EMAIL", "QUEUE", "ACTOR" ] },
  "InputModeEnum": { "type": "string", "enum": [ "OPTIONAL", "REQUIRED", "STATIC" ], "default": "OPTIONAL" },
  "RuntimeOptions": {
    "type": ["array", "null"],
    "minItems": 1, "uniqueItems": true, "items": { "$ref": "#/RuntimeOptionEnum" }
  },
  "RuntimeOptionsNotNull": {
    "type": "array",
    "minItems": 1, "uniqueItems": true, "items": { "$ref": "#/RuntimeOptionEnum" }
  },
  "TagsDefinition": {
    "type": "array",
    "uniqueItems": true,
    "items": { "type":  "string", "minLength": 1, "maxLength": 128 }
  },
  "JobAttributes": {
    "type": ["object"],
    "additionalProperties": false,
    "properties": {
      "description": { "type": ["string", "null"], "maxLength": 2048 },
      "dynamicExecSystem": { "type": "boolean", "default": false },
      "execSystemConstraints": {
        "type": ["array", "null"],
        "minItems": 1,
        "items": { "type":  "string", "minLength": 3 }
      },
      "execSystemId": { "$ref": "#/SystemId" },
      "execSystemExecDir": { "$ref": "#/DirPath" },
      "execSystemInputDir": { "$ref": "#/DirPath" },
      "execSystemOutputDir": { "$ref": "#/DirPath" },
      "execSystemLogicalQueue": { "type": ["string", "null"], "minLength": 1, "maxLength": 128 },
      "archiveSystemId": { "$ref": "#/SystemId" },
      "archiveDir": { "$ref": "#/DirPath" },
      "archiveOnAppError": { "type": "boolean", "default": true },
      "parameterSet": { "$ref": "#/ParameterSet" },
      "fileInputs": {
        "type": ["array", "null"],
        "items":  { "$ref": "#/FileInput" }
      },
      "fileInputArrays": {
        "type": ["array", "null"],
        "items":  { "$ref": "#/FileInputArray" }
      },
      "nodeCount": { "type": "integer", "default": -1 },
      "coresPerNode": { "type": "integer", "default": -1 },
      "memoryMB": { "type": "integer", "default": -1 },
      "maxMinutes": { "type": "integer", "default": -1 },
      "subscriptions": {
        "type": ["array", "null"],
        "items":  { "$ref": "#/NotificationSubscription" }
      },
      "tags": { "$ref": "#/TagsDefinition" }
    }
  },
  "ParameterSet": {
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "appArgs": {
        "type": ["array", "null"], "items":  { "$ref": "#/ArgSpec" }
      },
      "containerArgs": {
        "type": ["array", "null"], "items":  { "$ref": "#/ArgSpec" }
      },
      "schedulerOptions": {
        "type": ["array", "null"], "items":  { "$ref": "#/ArgSpec" }
      },
      "envVariables": {
        "type": ["array", "null"], "items":  { "$ref": "#/KeyValuePair" }
      },
      "archiveFilter": { "$ref": "#/ArchiveFilter" }
    }
  },
  "FileInput": {
    "type": "object",
    "required": [ "name" ],
    "additionalProperties": false,
    "properties": {
      "name": { "type": "string", "minLength": 1 },
      "description": { "type": "string", "maxLength": 8096 },
      "mode": { "$ref": "#/InputModeEnum" },
      "inPlace": { "type": "boolean", "default": false },
      "sourceUrl": { "type": "string", "format": "uri" },
      "targetPath": { "type": "string" },
      "meta": { "type": ["array", "null"],
                "uniqueItems": true,
                "items": { "$ref": "#/KeyValuePair" }
        }
    }
  },
  "FileInputArray": {
    "type": "object",
    "required": [ "name" ],
    "additionalProperties": false,
    "properties": {
      "name": { "type": "string", "minLength": 1 },
      "description": { "type": "string", "maxLength": 8096 },
      "mode": { "$ref": "#/InputModeEnum" },
      "inPlace": { "type": "boolean", "default": false },
      "sourceUrls": { "type": ["array", "null"], "items": { "type": "string", "format": "uri" }},
      "targetPaths": {"type": ["array", "null"], "items": { "type": "string" } },
      "meta": { "type": ["array", "null"],
                "uniqueItems": true,
                "items": { "$ref": "#/KeyValuePair" } }
    }
  },
  "NotificationSubscription": {
    "type": "object",
    "required": [ "notificationMechanisms" ],
    "additionalProperties": false,
    "properties": {
      "filter":  { "type": "string", "minLength": 1 },
      "notificationMechanisms": {
        "type": "array", "minItems": 1, "items": { "$ref": "#/NotificationMechanism" }
      }
    }
  },
  "NotificationMechanism": {
    "type": "object",
    "required": [ "mechanism" ],
    "mechanism": { "$ref": "#/NotificationMechanismEnum" },
    "webhookURL": { "type": "string" },
    "emailAddress": { "type":  "string" }
  },
  "ArchiveFilter" : {
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "includes": { "type": ["array", "null"], "items": { "type": "string", "minLength": 1 } },
      "excludes": { "type": ["array", "null"], "items": { "type": "string", "minLength": 1 } },
      "includeLaunchFiles": { "type": "boolean", "default": true }
    }
  },
  "ArgSpec": {
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "name": { "type": "string", "minLength": 1 },
      "description": { "type": "string" },
      "required": { "type": "boolean", "default": false },
      "arg": { "type":  "string" },
      "meta": { "type": ["array", "null"], "items": { "$ref": "#/KeyValuePair" } }
    }
  },
  "KeyValuePair": {
    "type": "object",
    "required": [ "key" ],
    "additionalProperties": false,
    "properties": {
      "key": { "type":  "string", "minLength": 1 },
      "value": { "type":  "string" }
    }
  }
}